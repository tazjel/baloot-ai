============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-7.4.3, pluggy-1.6.0 -- C:\Users\MiEXCITE\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\MiEXCITE\Downloads\py4web\examples\react-py4web
configfile: pytest.ini
plugins: anyio-3.7.1
collecting ... collected 12 items

tests/test_bidding_engine_unit.py::test_initial_state PASSED             [  8%]
tests/test_bidding_engine_unit.py::test_pass_round_1_all PASSED          [ 16%]
tests/test_bidding_engine_unit.py::test_pass_round_1_and_2_all PASSED    [ 25%]
tests/test_bidding_engine_unit.py::test_hokum_bid_round_1_success PASSED [ 33%]
tests/test_bidding_engine_unit.py::test_hokum_bid_round_1_wrong_suit PASSED [ 41%]
tests/test_bidding_engine_unit.py::test_sun_bid_hijack_hokum FAILED      [ 50%]
tests/test_bidding_engine_unit.py::test_gablak_trigger_simple PASSED     [ 58%]
tests/test_bidding_engine_unit.py::test_doubling_chain FAILED            [ 66%]
tests/test_bidding_engine_unit.py::test_sun_double_firewall PASSED       [ 75%]
tests/test_bidding_engine_unit.py::test_variant_selection FAILED         [ 83%]
tests/test_bidding_engine_unit.py::test_kawesh_pre_bid PASSED            [ 91%]
tests/test_bidding_engine_unit.py::test_kawesh_post_bid_rotation PASSED  [100%]

================================== FAILURES ===================================
__________________________ test_sun_bid_hijack_hokum __________________________

engine = <server.bidding_engine.BiddingEngine object at 0x000002C1A12D8950>

    def test_sun_bid_hijack_hokum(engine):
        # P0 bids Hokum
        engine.process_bid(0, "HOKUM", suit='♠')
        # P1 bids Sun (Higher Priority than anyone else for now? No, P1 is lower than P0, but turn is P1)
        res = engine.process_bid(1, "SUN")
        assert res.get("success") is True
>       assert res.get("phase_change") == "DOUBLING"
E       AssertionError: assert None == 'DOUBLING'
E        +  where None = <built-in method get of dict object at 0x000002C1A12E5B00>('phase_change')
E        +    where <built-in method get of dict object at 0x000002C1A12E5B00> = {'status': 'GABLAK_TRIGGERED', 'success': True, 'wait': 5}.get

tests\test_bidding_engine_unit.py:68: AssertionError
_____________________________ test_doubling_chain _____________________________

engine = <server.bidding_engine.BiddingEngine object at 0x000002C1A12DBCB0>

    def test_doubling_chain(engine):
        # 1. Finalize an auction (P0 bids Sun)
        engine.process_bid(0, "SUN")
        assert engine.phase == BiddingPhase.DOUBLING
    
        # 2. P1 (Opponent) Doubles
        res = engine.process_bid(1, "DOUBLE")
>       assert res.get("success") is True
E       AssertionError: assert None is True
E        +  where None = <built-in method get of dict object at 0x000002C1A1350800>('success')
E        +    where <built-in method get of dict object at 0x000002C1A1350800> = {'error': 'Sun Double Rejected. Firewall Active. Scores: us=0, them=0'}.get

tests\test_bidding_engine_unit.py:89: AssertionError
___________________________ test_variant_selection ____________________________

engine = <server.bidding_engine.BiddingEngine object at 0x000002C1A12D9880>

    def test_variant_selection(engine):
        # 1. Hokum Doubled
        engine.process_bid(0, "HOKUM", suit='♠')
        # P1 (Opponent) doubles
        engine.process_bid(1, "DOUBLE")
    
        # Everyone else passes to finish doubling
        engine.process_bid(3, "PASS") # P3 passes doubling
        res = engine.process_bid(2, "PASS") # P2 passes doubling
    
>       assert res.get("phase_change") == "VARIANT_SELECTION"
E       AssertionError: assert None == 'VARIANT_SELECTION'
E        +  where None = <built-in method get of dict object at 0x000002C1A134DA40>('phase_change')
E        +    where <built-in method get of dict object at 0x000002C1A134DA40> = {'error': 'Not enough priority to Gablak/Steal'}.get

tests\test_bidding_engine_unit.py:133: AssertionError
=========================== short test summary info ===========================
FAILED tests/test_bidding_engine_unit.py::test_sun_bid_hijack_hokum - Asserti...
FAILED tests/test_bidding_engine_unit.py::test_doubling_chain - AssertionErro...
FAILED tests/test_bidding_engine_unit.py::test_variant_selection - AssertionE...
========================= 3 failed, 9 passed in 0.07s =========================
